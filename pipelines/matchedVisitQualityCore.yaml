description: |
  Tier1 plots and metrics to assess repeatability of sources matched per tract
tasks:
  analyzeMatchedVisitCore:
    class: lsst.analysis.tools.tasks.AssociatedSourcesTractAnalysisTask
    config:
      connections.outputName: matchedVisitCore
      atools.PhotometricRepeatabilityMetric: PhotometricRepeatability
      atools.stellarPhotometricResiduals: StellarPhotometricResidualsFocalPlane
      atools.stellarAstrometricResidualsRA: StellarAstrometricResidualsRAFocalPlanePlot
      atools.stellarAstrometricResidualsDec: StellarAstrometricResidualsDecFocalPlanePlot
      atools.stellarAstrometricResidualStdDevRA: StellarAstrometricResidualStdDevRAFocalPlanePlot
      atools.stellarAstrometricResidualStdDevDec: StellarAstrometricResidualStdDevDecFocalPlanePlot
      atools.stellarAstrometricRepeatability1: AstrometricRelativeRepeatability
      atools.stellarAstrometricRepeatability1.xValue: 1
      atools.stellarAstrometricRepeatability1.process.calculateActions.rms.annulus: 5
      atools.stellarAstrometricRepeatability2: AstrometricRelativeRepeatability
      atools.stellarAstrometricRepeatability2.xValue: 2
      atools.stellarAstrometricRepeatability2.process.calculateActions.rms.annulus: 20
      atools.stellarAstrometricRepeatability3: AstrometricRelativeRepeatability
      atools.stellarAstrometricRepeatability3.xValue: 3
      atools.stellarAstrometricRepeatability3.process.calculateActions.rms.annulus: 200
      atools.stellarAstrometricRepeatability3.process.calculateActions.rms.threshAD: 30
      python: |
        from lsst.analysis.tools.atools import *
  analyzeMatchedVisitExtended:
    class: lsst.analysis.tools.tasks.AssociatedSourcesTractAnalysisTask
    config:
      bands: ['g', 'r', 'i', 'z', 'y']
      connections.outputName: matchedVisitExtended
      atools.modelPhotRepGalSn10to20: PhotometricRepeatability
      atools.modelPhotRepGalSn10to20.fluxType: cModelFlux
      atools.modelPhotRepGalSn10to20.process.filterActions.perGroupStdevFiltered.selectors.extendedness.op: gt
      atools.modelPhotRepGalSn10to20.process.filterActions.perGroupStdevFiltered.selectors.sn.minimum: 10
      atools.modelPhotRepGalSn10to20.process.filterActions.perGroupStdevFiltered.selectors.sn.maximum: 20
      atools.modelPhotRepGalSn10to20.produce.plot: NoPlot

      atools.modelPhotRepGalSn20to40: PhotometricRepeatability
      atools.modelPhotRepGalSn20to40.fluxType: cModelFlux
      atools.modelPhotRepGalSn20to40.process.filterActions.perGroupStdevFiltered.selectors.extendedness.op: gt
      atools.modelPhotRepGalSn20to40.process.filterActions.perGroupStdevFiltered.selectors.sn.minimum: 20
      atools.modelPhotRepGalSn20to40.process.filterActions.perGroupStdevFiltered.selectors.sn.maximum: 40
      # atools.modelPhotRepGalSn20to40.produce.plot: NoPlot
      python: |
        from lsst.analysis.tools.atools import *
        from lsst.analysis.tools.interfaces import *
